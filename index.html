<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#9333ea">
    <title>Budget Foyer</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            overscroll-behavior: contain;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="module">
    import React, { useState, useEffect } from 'https://cdn.skypack.dev/react';
    import ReactDOM from 'https://cdn.skypack.dev/react-dom';

    const App = () => {
        // Force le titre de la page
        useEffect(() => {
            document.title = "Budget Foyer";
        }, []);

        const moisFr = ['Janvier', 'FÃ©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'AoÃ»t', 'Septembre', 'Octobre', 'Novembre', 'DÃ©cembre'];
        const magasins = ['Carrefour', 'Leclerc', 'Auchan', 'IntermarchÃ©', 'Casino', 'Monoprix', 'Franprix', 'Lidl', 'Aldi', 'Super U', 'Hyper U', 'Biocoop', 'Picard'];
        const descriptions = ['Fruits et lÃ©gumes', 'Viande', 'Poisson', 'Pain', 'Produits laitiers', 'PÃ¢tes', 'Riz', 'Conserves', 'Boissons', 'Produits mÃ©nagers', 'HygiÃ¨ne'];

        const [moisActuel, setMoisActuel] = useState(new Date().getMonth());
        const [view, setView] = useState('dashboard');
        const [courses, setCourses] = useState(() => {
            const savedCourses = localStorage.getItem('courses');
            return savedCourses ? JSON.parse(savedCourses) : [];
        });
        const [editingCourse, setEditingCourse] = useState(null);
        const [showMagasinSuggestions, setShowMagasinSuggestions] = useState(false);
        const [showDescriptionSuggestions, setShowDescriptionSuggestions] = useState(false);
        const [filteredMagasins, setFilteredMagasins] = useState([]);
        const [filteredDescriptions, setFilteredDescriptions] = useState([]);
        const [montantsSuggeres, setMontantsSuggeres] = useState([]);
        const [nouvelleCourse, setNouvelleCourse] = useState({
            date: new Date().toISOString().split('T')[0],
            magasin: '',
            description: '',
            montant: ''
        });

        const [budgets, setBudgets] = useState(() => {
            const savedBudgets = localStorage.getItem('budgets');
            if (savedBudgets) return JSON.parse(savedBudgets);
            const initialBudgets = {};
            moisFr.forEach(mois => {
                initialBudgets[mois] = {
                    revenus: { salaire1: 0, salaire2: 0, allocations: 0, autres: 0 },
                    depenses: { loyer: 0, charges: 0, Ã©lectricitÃ©: 0, gaz: 0, eau: 0, restaurants: 0, cantines: 0, carburant: 0, transportsCommun: 0 }
                };
            });
            return initialBudgets;
        });

        useEffect(() +:+() => {
            localStorage.setItem('courses', JSON.stringify(courses));
        }, [courses]);

        useEffect(() => {
            localStorage.setItem('budgets', JSON.stringify(budgets));
        }, [budgets]);

        const calculerTotalCoursesMois = (mois) => {
            return courses.filter(course => new Date(course.date).getMonth() === moisFr.indexOf(mois))
                .reduce((sum, course) => sum + parseFloat(course.montant || 0), 0);
        };

        const calculerTotalRevenus = (mois) => {
            return Object.values(budgets[mois].revenus)
                .reduce((sum, valeur) => sum + parseFloat(valeur || 0), 0);
        };

        const calculerTotalDepenses = (mois) => {
            return Object.values(budgets[mois].depenses)
                .reduce((sum, valeur) => sum + parseFloat(valeur || 0), 0) + calculerTotalCoursesMois(mois);
        };

        const calculerSolde = (mois) => {
            return calculerTotalRevenus(mois) - calculerTotalDepenses(mois);
        };

        const handleMagasinChange = (value) => {
            setNouvelleCourse(prev => ({ ...prev, magasin: value }));
            if (value.length > 0) {
                const filtered = magasins.filter(magasin =>
                    magasin.toLowerCase().includes(value.toLowerCase())
                );
                setFilteredMagasins(filtered);
                setShowMagasinSuggestions(true);
                const achats = courses.filter(course =>
                    course.magasin.toLowerCase() === value.toLowerCase()
                );
                if (achats.length > 0) {
                    const montants = [...new Set(achats.map(course => parseFloat(course.montant)))]
                        .sort((a, b) => b - a).slice(0, 5);
                    setMontantsSuggeres(montants);
                }
            } else {
                setShowMagasinSuggestions(false);
                setMontantsSuggeres([]);
            }
        };

        const handleDescriptionChange = (value) => {
            setNouvelleCourse(prev => ({ ...prev, description: value }));
            if (value.length > 0) {
                const filtered = descriptions.filter(description =>
                    description.toLowerCase().includes(value.toLowerCase())
                );
                setFilteredDescriptions(filtered);
                setShowDescriptionSuggestions(true);
            } else {
                setShowDescriptionSuggestions(false);
            }
        };

        const selectMagasin = (magasin) => {
            setNouvelleCourse(prev => ({ ...prev, magasin: magasin }));
            setShowMagasinSuggestions(false);
            const achats = courses.filter(course => course.magasin === magasin);
            if (achats.length > 0) {
                const montants = [...new Set(achats.map(course => parseFloat(course.montant)))]
                    .sort((a, b) => b - a).slice(0, 5);
                setMontantsSuggeres(montants);
            }
        };

        const selectDescription = (description) => {
            setNouvelleCourse(prev => ({ ...prev, description: description }));
            setShowDescriptionSuggestions(false);
        };

        const selectMontant = (montant) => {
            setNouvelleCourse(prev => ({ ...prev, montant: montant.toString() }));
        };

        const ajouterCourse = () => {
            if (nouvelleCourse.montant && nouvelleCourse.date) {
                setCourses(prevCourses => [...prevCourses, { ...nouvelleCourse, id: Date.now() }]);
                setNouvelleCourse({
                    date: new Date().toISOString().split('T')[0],
                    magasin: '',
                    description: '',
                    montant: ''
                });
                setMontantsSuggeres([]);
                setShowMagasinSuggestions(false);
                setShowDescriptionSuggestions(false);
            }
        };

        const supprimerCourse = (id) => {
            setCourses(prevCourses => prevCourses.filter(course => course.id !== id));
        };

        const updateBudget = (mois, type, field, value) => {
            setBudgets(prevBudgets => ({
                ...prevBudgets,
                [mois]: {
                    ...prevBudgets[mois],
                    [type]: {
                        ...prevBudgets[mois][type],
                        [field]: value
                    }
                }
            }));
        };

        const moisCourant = moisFr[moisActuel];
        const revenus = calculerTotalRevenus(moisCourant);
        const depenses = calculerTotalDepenses(moisCourant);
        const solde = calculerSolde(moisCourant);
        const tauxEpargne = revenus > 0 ? ((solde / revenus) * 100).toFixed(1) : 0;

        return React.createElement(
            'div',
            { className: 'min-h-screen bg-gray-50 pb-20' },
            React.createElement(
                'div',
                { className: 'max-w-md mx-auto' },
                React.createElement(
                    'div',
                    { className: 'bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6 shadow-lg' },
                    React.createElement('h1', { className: 'text-2xl font-bold' }, 'Budget Foyer'),
                    React.createElement('p', { className: 'text-sm opacity-90 mt-1' }, 'GÃ©rez votre budget facilement')
                ),
                React.createElement(
                    'div',
                    { className: 'p-4' },
                    view === 'dashboard' && React.createElement(
                        'div',
                        { className: 'space-y-4' },
                        React.createElement(
                            'div',
                            { className: 'flex items-center justify-between mb-4' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' }, moisCourant),
                            React.createElement(
                                'select',
                                {
                                    value: moisActuel,
                                    onChange: (e) => setMoisActuel(parseInt(e.target.value)),
                                    className: 'px-3 py-2 border rounded-lg bg-white'
                                },
                                moisFr.map((mois, index) =>
                                    React.createElement('option', { key: index, value: index }, mois)
                                )
                            )
                        ),
                        React.createElement(
                            'div',
                            { className: 'grid grid-cols-2 gap-3' },
                            React.createElement(
                                'div',
                                { className: 'bg-gradient-to-br from-green-400 to-green-600 rounded-xl p-4 text-white shadow-lg' },
                                React.createElement('div', { className: 'text-sm opacity-90' }, 'Revenus'),
                                React.createElement('div', { className: 'text-2xl font-bold mt-1' }, `${revenus.toFixed(0)} â‚¬`)
                            ),
                            React.createElement(
                                'div',
                                { className: 'bg-gradient-to-br from-red-400 to-red-600 rounded-xl p-4 text-white shadow-lg' },
                                React.createElement('div', { className: 'text-sm opacity-90' }, 'DÃ©penses'),
                                React.createElement('div', { className: 'text-2xl font-bold mt-1' }, `${depenses.toFixed(0)} â‚¬`)
                            ),
                            React.createElement(
                                'div',
                                {
                                    className: `rounded-xl p-4 text-white shadow-lg ${
                                        solde >= 0 ? 'bg-gradient-to-br from-blue-400 to-blue-600' : 'bg-gradient-to-br from-orange-400 to-orange-600'
                                    }`
                                },
                                React.createElement('div', { className: 'text-sm opacity-90' }, 'Solde'),
                                React.createElement('div', { className: 'text-2xl font-bold mt-1' }, `${solde.toFixed(0)} â‚¬`)
                            ),
                            React.createElement(
                                'div',
                                { className: 'bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl p-4 text-white shadow-lg' },
                                React.createElement('div', { className: 'text-sm opacity-90' }, 'Taux Ã‰pargne'),
                                React.createElement('div', { className: 'text-2xl font-bold mt-1' }, `${tauxEpargne}%`)
                            )
                        ),
                        React.createElement(
                            'div',
                            { className: 'bg-white rounded-xl p-4 shadow-md' },
                            React.createElement(
                                'div',
                                { className: 'flex items-center justify-between mb-3' },
                                React.createElement('h3', { className: 'font-semibold text-gray-800' }, 'ðŸ›’ Courses du mois'),
                                React.createElement('span', { className: 'text-lg font-bold text-green-600' }, `${calculerTotalCoursesMois(moisCourant).toFixed(2)} â‚¬`)
                            ),
                            React.createElement(
                                'div',
                                { className: 'text-sm text-gray-600' },
                                `${courses.filter(course => new Date(course.date).getMonth() === moisActuel).length} achats`
                            )
                        )
                    ),
                    view === 'courses' && React.createElement(
                        'div',
                        { className: 'space-y-4' },
                        React.createElement(
                            'div',
                            { className: 'flex items-center justify-between' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' }, 'Courses'),
                            React.createElement('div', { className: 'text-xl font-bold text-green-600' }, `${calculerTotalCoursesMois(moisFr[moisActuel]).toFixed(2)} â‚¬`)
                        ),
                        React.createElement(
                            'div',
                            { className: 'bg-white rounded-xl p-4 shadow-md' },
                            React.createElement('h3', { className: 'font-semibold mb-3 text-gray-800' }, 'Nouvel achat'),
                            React.createElement(
                                'div',
                                { className: 'space-y-3' },
                                React.createElement('input', {
                                    type: 'date',
                                    value: nouvelleCourse.date,
                                    onChange: (e) => setNouvelleCourse(prev => ({ ...prev, date: e.target.value })),
                                    className: 'w-full px-3 py-2 border rounded-lg'
                                }),
                                React.createElement(
                                    'div',
                                    { className: 'relative' },
                                    React.createElement('input', {
                                        type: 'text',
                                        placeholder: 'Magasin',
                                        value: nouvelleCourse.magasin,
                                        onChange: (e) => handleMagasinChange(e.target.value),
                                        className: 'w-full px-3 py-2 border rounded-lg'
                                    }),
                                    showMagasinSuggestions && filteredMagasins.length > 0 && React.createElement(
                                        'div',
                                        { className: 'absolute z-10 w-full bg-white border rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto' },
                                        filteredMagasins.map((magasin, index) =>
                                            React.createElement('div', {
                                                key: index,
                                                onClick: () => selectMagasin(magasin),
                                                className: 'px-3 py-2 hover:bg-blue-50 cursor-pointer border-b'
                                            }, magasin)
                                        )
                                    )
                                ),
                                React.createElement(
                                    'div',
                                    { className: 'relative' },
                                    React.createElement('input', {
                                        type: 'text',
                                        placeholder: 'Description',
                                        value: nouvelleCourse.description,
                                        onChange: (e) => handleDescriptionChange(e.target.value),
                                        className: 'w-full px-3 py-2 border rounded-lg'
                                    }),
                                    showDescriptionSuggestions && filteredDescriptions.length > 0 && React.createElement(
                                        'div',
                                        { className: 'absolute z-10 w-full bg-white border rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto' },
                                        filteredDescriptions.map((description, index) =>
                                            React.createElement('div', {
                                                key: index,
                                                onClick: () => selectDescription(description),
                                                className: 'px-3 py-2 hover:bg-blue-50 cursor-pointer border-b'
                                            }, description)
                                        )
                                    )
                                ),
                                React.createElement(
                                    'div',
                                    null,
                                    React.createElement('input', {
                                        type: 'number',
                                        step: '0.01',
                                        placeholder: 'Montant',
                                        value: nouvelleCourse.montant,
                                        onChange: (e) => setNouvelleCourse(prev => ({ ...prev, montant: e.target.value })),
                                        className: 'w-full px-3 py-2 border rounded-lg'
                                    }),
                                    montantsSuggeres.length > 0 && React.createElement(
                                        'div',
                                        { className: 'mt-2' },
                                        React.createElement('div', { className: 'text-xs text-gray-500 mb-1' }, 'Montants habituels'),
                                        React.createElement(
                                            'div',
                                            { className: 'flex flex-wrap gap-2' },
                                            montantsSuggeres.map((montant, index) =>
                                                React.createElement('button', {
                                                    key: index,
                                                    onClick: () => selectMontant(montant),
                                                    className: 'px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm'
                                                }, `${montant.toFixed(2)} â‚¬`)
                                            )
                                        )
                                    )
                                ),
                                React.createElement(
                                    'button',
                                    {
                                        onClick: ajouterCourse,
                                        className: 'w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-semibold'
                                    },
                                    '+ Ajouter'
                                )
                            ),
                            React.createElement(
                                'div',
                                { className: 'space-y-2' },
                                React.createElement('h3', { className: 'font-semibold text-gray-800' }, 'Historique'),
                                courses
                                    .filter(course => new Date(course.date).getMonth() === moisActuel)
                                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                                    .map(course =>
                                        React.createElement(
                                            'div',
                                            { key: course.id, className: 'bg-white rounded-lg p-3 shadow-sm' },
                                            React.createElement(
                                                'div',
                                                { className: 'flex justify-between items-start' },
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    React.createElement('div', { className: 'font-semibold text-gray-800' }, course.magasin || 'Sans nom'),
                                                    React.createElement('div', { className: 'text-sm text-gray-600' }, new Date(course.date).toLocaleDateString('fr-FR')),
                                                    course.description && React.createElement('div', { className: 'text-xs text-gray-500 mt-1' }, course.description)
                                                ),
                                                React.createElement(
                                                    'div',
                                                    { className: 'text-right' },
                                                    React.createElement('div', { className: 'text-lg font-bold text-green-600' }, `${parseFloat(course.montant).toFixed(2)} â‚¬`),
                                                    React.createElement(
                                                        'div',
                                                        { className: 'flex gap-1 mt-1' },
                                                        React.createElement(
                                                            'button',
                                                            {
                                                                onClick: () => supprimerCourse(course.id),
                                                                className: 'p-1 text-red-600 hover:bg-red-50 rounded text-sm'
                                                            },
                                                            'ðŸ—‘ï¸'
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                            )
                        ),
                        view === 'budget' && React.createElement(
                            'div',
                            { className: 'space-y-4' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' }, `Budget - ${moisCourant}`),
                            React.createElement(
                                'div',
                                { className: 'bg-white rounded-xl p-4 shadow-md' },
                                React.createElement('h3', { className: 'font-semibold text-green-700 mb-3' }, 'Revenus'),
                                React.createElement(
                                    'div',
                                    { className: 'space-y-2' },
                                    Object.entries(budgets[moisCourant].revenus).map(([key, value]) =>
                                        React.createElement(
                                            'div',
                                            { key: key },
                                            React.createElement('label', { className: 'text-sm text-gray-600' }, key),
                                            React.createElement('input', {
                                                type: 'number',
                                                step: '0.01',
                                                value: value,
                                                onChange: (e) => updateBudget(moisCourant, 'revenus', key, e.target.value),
                                                className: 'w-full px-3 py-2 border rounded-lg mt-1'
                                            })
                                        )
                                    ),
                                    React.createElement('div', { className: 'pt-2 border-t font-semibold text-green-700' }, `Total: ${calculerTotalRevenus(moisCourant).toFixed(2)} â‚¬`)
                                )
                            ),
                            React.createElement(
                                'div',
                                { className: 'bg-white rounded-xl p-4 shadow-md' },
                                React.createElement('h3', { className: 'font-semibold text-red-700 mb-3' }, 'DÃ©penses'),
                                React.createElement(
                                    'div',
                                    { className: 'space-y-2' },
                                    Object.entries(budgets[moisCourant].depenses).map(([key, value]) =>
                                        React.createElement(
                                            'div',
                                            { key: key },
                                            React.createElement('label', { className: 'text-sm text-gray-600' }, key),
                                            React.createElement('input', {
                                                type: 'number',
                                                step: '0.01',
                                                value: value,
                                                onChange: (e) => updateBudget(moisCourant, 'depenses', key, e.target.value),
                                                className: 'w-full px-3 py-2 border rounded-lg mt-1'
                                            })
                                        )
                                    ),
                                    React.createElement('div', { className: 'bg-green-50 p-2 rounded' },
                                        React.createElement('label', { className: 'text-sm text-gray-600' }, 'Courses auto'),
                                        React.createElement('div', { className: 'font-semibold text-green-700' }, `${calculerTotalCoursesMois(moisCourant).toFixed(2)} â‚¬`)
                                    ),
                                    React.createElement('div', { className: 'pt-2 border-t font-semibold text-red-700' }, `Total: ${calculerTotalDepenses(moisCourant).toFixed(2)} â‚¬`)
                                )
                            )
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: 'fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg' },
                        React.createElement(
                            'div',
                            { className: 'max-w-md mx-auto flex justify-around py-3' },
                            React.createElement(
                                'button',
                                {
                                    onClick: () => setView('dashboard'),
                                    className: `flex flex-col items-center gap-1 px-4 ${view === 'dashboard' ? 'text-purple-600' : 'text-gray-500'}`
                                },
                                React.createElement('span', null, 'ðŸ '),
                                React.createElement('span', { className: 'text-xs' }, 'Accueil')
                            ),
                            React.createElement(
                                'button',
                                {
                                    onClick: () => setView('courses'),
                                    className: `flex flex-col items-center gap-1 px-4 ${view === 'courses' ? 'text-purple-600' : 'text-gray-500'}`
                                },
                                React.createElement('span', null, 'ðŸ›’'),
                                React.createElement('span', { className: 'text-xs' }, 'Courses')
                            ),
                            React.createElement(
                                'button',
                                {
                                    onClick: () => setView('budget'),
                                    className: `flex flex-col items-center gap-1 px-4 ${view === 'budget' ? 'text-purple-600' : 'text-gray-500'}`
                                },
                                React.createElement('span', null, 'ðŸ’°'),
                                React.createElement('span', { className: 'text-xs' }, 'Budget')
                            )
                        )
                    )
                )
            )
        );
    };

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
</script>

    </script>
</body>
</html>
